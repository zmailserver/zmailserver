http://bugzilla.zimbra.com/show_bug.cgi?id=31430

Requirements:

Ability to do bulk provisioning via admin console for domain admins via csv
file import.

user@domain.tld, displayname, password

see the following url for a functional spec and overview.
http://twiki.corp.yahoo.com/view/Mail/ZimbraLDAPPasswordMigration

------------------------------------------------------------------------------------------------
Work flows/Function specs:

Client (User)                             |                               ZCS
                                          |
Upload -----------------------------------|---------------------------> Return the uploaded file attachmentId

                                          |
List of Accounts to be provisioned   -----|---------------------------> Parse and validate the CSV file and rturn the number of accounts
(GetBulkProvisionAccountsRequest)
                                          |
User Check Required Fields                |
And init provision commands          -----|---------------------------->
                                          |                              Accounts are provisioned one by one
Account Provision Status updated     <----|-----------------------------
                                          |
Download Account provision Summary   -----|----------------------------> A summary file is returned for download (CSV Also)

                                       Done!



1) Parse and Validation of CSV file
   - CSV File format
   - The accounts must have the domain name and should be in the current domain
     (Global Admin can create accounts in all the existing domains)

2) List of accounts to be provisioned  (use zimbraAdminExt:GetBulkProvisionAccountsRequest )
   account name / display name / password /  checkbox (allow provision or not) / checkbox (Users must change passwords on first login)/ Provision Status (succeed/failed with error info)

   Nice to have:
    a) allow editing of lists
    b) allow add more accounts

3) provision accounts  (use zimbraAdmin:CreateAccountRequest)
   - Display and update the create status
   - Use a loop to iterate through all the accounts and disable the UI with Cancel option and status display
   - zimbraPasswordMustChange=TRUE
   - the status will keep on the client side
    
4) Allow the provision summary to be downloaded.
   - Should use the server data

   ? csv vs HTML (maybe both can be provided)
    - HTML : better display
    - CSV: allow easy edit the csv file and resubmit

-----------------------------------------------------------------------------------------------------
Soap Commands:

namespaces: urn:zimbraAdminExt

-----------------------------------
<GetBulkProvisionAccountsRequest accountLimit="20">
    <aid>uploaded csv file attachment id</aid>
</GetBulkProvisionAccountsRequest>

<GetBulkProvisonAccountsResponse>
    <aid>uploaded csv file attachment id</aid>
    <isValidCSV>TURE/FALSE</isValidCSV>?
    <account>
        <a n="attr-name">...</a>+
    </account>+
<GetBulkProvisonAccountsResponse>


1) accountLimit - the available accounts allowed by license key.
It is total accounts in license file - accounts used
(This attributes can't get directory from server side since LicenseManager can't be
 called from BulkProvision Extension, so we use the GetLicense Soap request to get these information)
 
account attrs:
   1) accountName
   2) displayName
   3) password
   4) status (optional)
   5) isValid: some rows of the csv file may be corrupted
       - invalid domain name
       - password too weak
       value: TRUE or FALSE
   6) mustChangePassword (optional) - only set when the password is auto-generated by system

----------------------------------------

<UpdateBulkProvisionStatusRequest>
     <aid>uploaded csv file attachment id</aid>
    <account>
        <name>accountName</name>
        <status>provisionStatus</status>
    <account>+
</UpdateBulkProvisionStatusRequest>

<UpdateBulkProvisionStatusResponse />

Note: this soap command is used to push the account creation status to the server,
      So the status summary information can be downloaded.
      
-----------------------------------------------------------------------------------------------------
Sample XML files
-----------------------------------------------------------------------------------------------------
gmailexample.xml - this file shows an example of an XML file that is used to import mail for one account via IMAP from GMAIL without provisioning the email account in ZCS. 
In this example, it is assumed that the email account in ZCS has already been provisioned.

bulkprovisionexample1.xml - this file shows an example of an XML file that is used to provision multiple email accounts without importing mail.  

bulkprovisionexample2.xml - this file shows an example of an XML file that is used to provision multiple email accounts for externally hosted domain without importing mail.
In this exampe, zimbraMailTransport attribute of newly provisioned account will be set to point to external SMTP server instead of ZCS server. 
